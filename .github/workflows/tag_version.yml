name: Tag Version on Push to Master

on:
  push:
    branches:
      - develop

jobs:
  tag_version:

    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v4

      - name: Read version from pubspec.yml
        id: read_version
        run: |
          VERSION=$(grep '^version: ' pubspec.yml | cut -d ' ' -f 2)
          echo "VERSION=$VERSION" >> $GITHUB_ENV

      - name: Create tag
        id: create_tag
        run: |
          landa-messenger-api chat-send \
            --id "${{ secrets.CHAT_ID }}" \
            --api_key "${{ secrets.CHAT_KEY }}" \
            --title "ðŸŸ¢ Test version" \
            --body "${{ github.repository }}: v${{ env.VERSION }}" \
            --url "https://github.com/landamessenger/object/actions/workflows/tag_version.yml" \
            --image "https://avatars.githubusercontent.com/u/63705403?s=200&v=4" \
            --background_color "#55000000" \
            --text_color "#FFFFFFFF"

      - name: Tag pushed confirmation
        run: echo "Tag v${{ env.VERSION }} created and pushed!"
